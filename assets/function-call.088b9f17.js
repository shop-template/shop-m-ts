import{a as A,n as X,t as $,m as k,d as _,v as H,j as se,y as L,z as N,E as ie,B as Y,S as K,U as re,e as c,aa as le,aB as ce,K as B,D as V,I as G,w as J,N as Z,r as Q,at as ue,p as O,ax as D,as as me,b as de,C as ve,a1 as ge,au as fe,a5 as he,aC as we,ad as ye,k as E,q as U,$ as Pe,a6 as xe,aD as Ie,l as Se,aE as Ce,aF as Te}from"./index.3aea5e33.js";import{a as ze,S as be}from"./index.188b6061.js";const[Xe,z]=A("image"),$e={src:String,alt:String,fit:String,position:String,round:Boolean,width:X,height:X,radius:X,lazyLoad:Boolean,iconSize:X,showError:$,errorIcon:k("photo-fail"),iconPrefix:String,showLoading:$,loadingIcon:k("photo")};var Ye=_({name:Xe,props:$e,emits:["load","error"],setup(e,{emit:u,slots:o}){const r=H(!1),s=H(!0),d=H(),{$Lazyload:m}=se().proxy,g=L(()=>{const n={width:N(e.width),height:N(e.height)};return ie(e.radius)&&(n.overflow="hidden",n.borderRadius=N(e.radius)),n});Y(()=>e.src,()=>{r.value=!1,s.value=!0});const f=n=>{s.value=!1,u("load",n)},v=n=>{r.value=!0,s.value=!1,u("error",n)},C=(n,a,w)=>w?w():c(G,{name:n,size:e.iconSize,class:a,classPrefix:e.iconPrefix},null),y=()=>{if(s.value&&e.showLoading)return c("div",{class:z("loading")},[C(e.loadingIcon,z("loading-icon"),o.loading)]);if(r.value&&e.showError)return c("div",{class:z("error")},[C(e.errorIcon,z("error-icon"),o.error)])},P=()=>{if(r.value||!e.src)return;const n={alt:e.alt,class:z("img"),style:{objectFit:e.fit,objectPosition:e.position}};return e.lazyLoad?le(c("img",B({ref:d},n),null),[[ce("lazy"),e.src]]):c("img",B({src:e.src,onLoad:f,onError:v},n),null)},h=({el:n})=>{const a=()=>{n===d.value&&s.value&&f()};d.value?a():V(a)},x=({el:n})=>{n===d.value&&!r.value&&v()};return m&&K&&(m.$on("loaded",h),m.$on("error",x),re(()=>{m.$off("loaded",h),m.$off("error",x)})),()=>{var n;return c("div",{class:z({round:e.round}),style:g.value},[P(),y(),(n=o.default)==null?void 0:n.call(o)])}}});const De=J(Ye),j=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),q=A("image-preview")[1];var Le=_({props:{src:String,show:Boolean,active:Number,minZoom:Z(X),maxZoom:Z(X),rootWidth:Z(Number),rootHeight:Z(Number)},emits:["scale","close"],setup(e,{emit:u}){const o=Q({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}),r=ue(),s=L(()=>{const{rootWidth:t,rootHeight:i}=e,l=i/t;return o.imageRatio>l}),d=L(()=>{const{scale:t,moveX:i,moveY:l,moving:I,zooming:T}=o,R={transitionDuration:T||I?"0s":".3s"};if(t!==1){const ae=i/t,ne=l/t;R.transform=`scale(${t}, ${t}) translate(${ae}px, ${ne}px)`}return R}),m=L(()=>{if(o.imageRatio){const{rootWidth:t,rootHeight:i}=e,l=s.value?i/o.imageRatio:t;return Math.max(0,(o.scale*l-t)/2)}return 0}),g=L(()=>{if(o.imageRatio){const{rootWidth:t,rootHeight:i}=e,l=s.value?i:t*o.imageRatio;return Math.max(0,(o.scale*l-i)/2)}return 0}),f=t=>{t=D(t,+e.minZoom,+e.maxZoom+1),t!==o.scale&&(o.scale=t,u("scale",{scale:t,index:e.active}))},v=()=>{f(1),o.moveX=0,o.moveY=0},C=()=>{const t=o.scale>1?1:2;f(t),o.moveX=0,o.moveY=0};let y,P,h,x,n,a,w;const S=t=>{const{touches:i}=t,{offsetX:l}=r;r.start(t),y=i.length,P=o.moveX,h=o.moveY,w=Date.now(),o.moving=y===1&&o.scale!==1,o.zooming=y===2&&!l.value,o.zooming&&(x=o.scale,n=j(t.touches))},ee=t=>{const{touches:i}=t;if(r.move(t),(o.moving||o.zooming)&&O(t,!0),o.moving){const{deltaX:l,deltaY:I}=r,T=l.value+P,R=I.value+h;o.moveX=D(T,-m.value,m.value),o.moveY=D(R,-g.value,g.value)}if(o.zooming&&i.length===2){const l=j(i),I=x*l/n;f(I)}},oe=()=>{if(y>1)return;const{offsetX:t,offsetY:i}=r,l=Date.now()-w,I=250,T=5;t.value<T&&i.value<T&&l<I&&(a?(clearTimeout(a),a=null,C()):a=setTimeout(()=>{u("close"),a=null},I))},F=t=>{let i=!1;(o.moving||o.zooming)&&(i=!0,o.moving&&P===o.moveX&&h===o.moveY&&(i=!1),t.touches.length||(o.zooming&&(o.moveX=D(o.moveX,-m.value,m.value),o.moveY=D(o.moveY,-g.value,g.value),o.zooming=!1),o.moving=!1,P=0,h=0,x=1,o.scale<1&&v(),o.scale>e.maxZoom&&(o.scale=+e.maxZoom))),O(t,i),oe(),r.reset()},te=t=>{const{naturalWidth:i,naturalHeight:l}=t.target;o.imageRatio=l/i};return Y(()=>e.active,v),Y(()=>e.show,t=>{t||v()}),()=>{const t={loading:()=>c(me,{type:"spinner"},null)};return c(ze,{class:q("swipe-item"),onTouchstart:S,onTouchmove:ee,onTouchend:F,onTouchcancel:F},{default:()=>[c(De,{src:e.src,fit:"contain",class:q("image",{vertical:s.value}),style:d.value,onLoad:te},t)]})}}});const[Re,b]=A("image-preview"),Ze=["show","transition","overlayStyle","closeOnPopstate"],Ee={show:Boolean,loop:$,images:ye(),minZoom:E(1/3),maxZoom:E(3),overlay:$,closeable:Boolean,showIndex:$,className:U,closeIcon:k("clear"),transition:String,beforeClose:Function,overlayClass:U,overlayStyle:Object,swipeDuration:E(300),startPosition:E(0),showIndicators:Boolean,closeOnPopstate:$,closeIconPosition:k("top-right")};var p=_({name:Re,props:Ee,emits:["scale","close","closed","change","update:show"],setup(e,{emit:u,slots:o}){const r=H(),s=Q({active:0,rootWidth:0,rootHeight:0}),d=()=>{if(r.value){const a=Pe(r.value.$el);s.rootWidth=a.width,s.rootHeight=a.height,r.value.resize()}},m=a=>u("scale",a),g=a=>u("update:show",a),f=()=>{xe(e.beforeClose,{args:[s.active],done:()=>g(!1)})},v=a=>{a!==s.active&&(s.active=a,u("change",a))},C=()=>{if(e.showIndex)return c("div",{class:b("index")},[o.index?o.index({index:s.active}):`${s.active+1} / ${e.images.length}`])},y=()=>{if(o.cover)return c("div",{class:b("cover")},[o.cover()])},P=()=>c(be,{ref:r,lazyRender:!0,loop:e.loop,class:b("swipe"),duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:v},{default:()=>[e.images.map(a=>c(Le,{src:a,show:e.show,active:s.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:s.rootWidth,rootHeight:s.rootHeight,onScale:m,onClose:f},null))]}),h=()=>{if(e.closeable)return c(G,{role:"button",name:e.closeIcon,class:[b("close-icon",e.closeIconPosition),Ie],onClick:f},null)},x=()=>u("closed"),n=(a,w)=>{var S;return(S=r.value)==null?void 0:S.swipeTo(a,w)};return de({swipeTo:n}),ve(d),Y([ge,fe],d),Y(()=>e.startPosition,a=>v(+a)),Y(()=>e.show,a=>{const{images:w,startPosition:S}=e;a?(v(+S),V(()=>{d(),n(+S,{immediate:!0})})):u("close",{index:s.active,url:w[s.active]})}),()=>c(we,B({class:[b(),e.className],overlayClass:[b("overlay"),e.overlayClass],onClosed:x,"onUpdate:show":g},he(e,Ze)),{default:()=>[h(),P(),C(),y()]})}});let W;const He={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};function We(){({instance:W}=Ce({setup(){const{state:e,toggle:u}=Te(),o=()=>{e.images=[]};return()=>c(p,B(e,{onClosed:o,"onUpdate:show":u}),null)}}))}const M=(e,u=0)=>{if(!!K)return W||We(),e=Array.isArray(e)?{images:e,startPosition:u}:e,W.open(Se({},He,e)),W};M.Component=J(p);M.install=e=>{e.use(M.Component)};export{De as I,M as a};
